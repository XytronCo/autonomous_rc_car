자율주행 모형자동차 통합플랫폼
====

[[개요]](#개요)

[[작업 환경 셋업]](#작업-환경-셋업)

[[환경 구성도]](#환경-구성도)

[[Jetson TX2 보드에 VNC 접속하기]](#jetson-tx2-보드에-vnc-접속하기)

[[UI 화면 정의]](#ui-화면-정의)

[[camera]](#camera)

[[filter camera]](#filter-camera)

[[자율 주행 실행하기]](#자율-주행-실행하기)

[[카메라의 위치 조정하기]](#카메라의-위치-조정하기)

[ [자율주행 프로그램 실행하기]](#자율주행-프로그램-실행하기)



개요
---------

-   Xycar 프로젝트는 카메라 영상을 통해 도로를 인식하여 자율 주행하는 HW와 SW 오픈소스 통합 플랫폼이다.

-   Xycar는 1/10 크기 RC카의 차체 프레임과 모터를 사용하고 그 위에 엔비디아 프로세서 모듈과 각종 센서, 그리고 배터리를 장착하여 제작된 자율주행 모형자동차이다. ROS 기반의 플랫폼에서 SW가 동작한다.

![image](https://user-images.githubusercontent.com/44758482/49715229-0dfee200-fc93-11e8-86f0-64385e32319b.png)

-   Xycar 카메라의 영상은 다음과 같은 과정을 거쳐서 영상을 처리하여 도로를 인식한다.
    영상처리의 과정은 RGB영상의 연산량을 줄이기 위해 gray scale로 변환하고 흑백 영상에서 노이즈를 감소시키기 위해 Blur처리를 한다. 
    Blur처리된 영상에서 canny edge detection을 사용하여 edge부분을 검출하고 정확한 방향성 확인을 위해 
    warper함수를 사용하여 Top View로 변환한다.
    
   ![image](https://user-images.githubusercontent.com/44758482/49716036-cfb6f200-fc95-11e8-9bf6-522af46e37a4.png)

작업 환경 셋업 
===============

환경 구성도
-----------

-   Xycar에는 Jetson TX2 보드가 장착되어 있다. 왠만한 PC보다 성능이 좋은 프로세서 보드이며 저장공간으로 250GByte 대용량의 SSD가 붙어 있다.

-   특별한 이유가 아니면 별도의 개발용 PC가 필요하지 않다. 코딩과 컴파일 등 대부분의 작업을 Jetson TX2 보드에서 직접 진행할 수 있다.

-   다음과 같이 TX2 보드에 모니터와 키보드, 마우스를 붙여서 개발 PC처럼 사용하면 된다. TX2보드에서는 유선(이더넷)과 무선(와이파이) 네트워크 연결을 모두 지원한다.

![](https://user-images.githubusercontent.com/44761194/49775591-047d8480-fd3c-11e8-996b-da3822a2a714.png)

-   다음과 같이 자동차의 케이스를 벗기고 TX2 보드의 USB/HDMI/Ethernet 포트에 각각 USB 허브와 LCD 모니터와 이더넷 케이블을 연결하여 사용하면 된다.

![](https://user-images.githubusercontent.com/44761194/49775601-08110b80-fd3c-11e8-9bdc-e9d0487c519b.png)

Jetson TX2 보드에 VNC 접속하기
------------------------------

-   작업용 PC에서 TX2 보드의 활성화된 AP에 접속한다. VNC 클라이언트 프로그램을 이용해서 차량에 접속한다. IP는 10.42.0.1이다. VNC비밀번호는 nvidia를 입력한다.

![](https://user-images.githubusercontent.com/44761194/49775604-0b0bfc00-fd3c-11e8-8252-83fc5437950e.png)

vnc화면의 해상도는 연결화면에서 터미널을 열어서 xrandr --fb 1000x1000을 입력하여 화면을 크게 만든다.

UI 화면 정의
============

camera
-------------------------------------------------------------------------------------

![](https://user-images.githubusercontent.com/44761194/49775610-0e9f8300-fd3c-11e8-8fda-136b945ec8d8.png)

-   1번 : 동영상 확대
-   2번 : 동영상 축소
-   3번 : 현재 화면

현재 카메라에 바로 보이는 화면이다.

번호가 적혀있는 버튼 이외에는 동작하지 않는다.

filter camera
---------------------------------------------------------------------------------------------

![](https://user-images.githubusercontent.com/44761194/49775616-12330a00-fd3c-11e8-96a0-e8e1d1bab60f.png)

-   1번 : 동영상 확대
-   2번 : 동영상 축소
-   3번 : 현재 화면

현재 카메라 화면을 여러가지 필터로 위에서 보는 형태로 변형시키고, 겉 선만 추출한 뒤 도로를 인식하는 코드를 적용시킨 화면이다.

번호가 적혀있는 버튼 이외에는 동작하지 않는다.


자율 주행 실행하기
==================

카메라의 위치 조정하기
----------------------

-   트랙의 라인과 카메라 위치 조정하는 방법

    -   터미널 창에서 roslaunch racecar cam\_xycar.launch를 실행한다. 정상 실행되면 카메라영상과 라인을 구분하는 영상이 출력된다.

    -   트랙의 중앙선에 차량을 위치시키고 카메라를 손으로 상하좌우를 조정하여 아래 영상처럼 왼쪽 라인 기준선에 맞춘다.

![](https://user-images.githubusercontent.com/44761194/49775642-224ae980-fd3c-11e8-8058-a21f615e8b66.png)

![](https://user-images.githubusercontent.com/44761194/49775648-2545da00-fd3c-11e8-97be-da8b4da51f0c.png)

-   카메라 위치 맞추는 작업이 끝나면 cam\_xycar.launch파일을 실행한 터미널에서 Ctrl+c키로 중지 시킨다.

자율주행 프로그램 실행하기
--------------------------

-   트랙의 라인과 카메라 위치를 조정했으면 roslaunch racecar auto\_xycar.launch 명령을 실행하여 차량을 주행시킨다.

-   야외나 주행트랙에서 자동차를 운행시키면서 자동차 안의 코드를 고치거나 실행시키려면 외부에 노트북을 두고 외아파이로 원격 접속하여 로그인 하는 것이 작업하기에 편리하다.
